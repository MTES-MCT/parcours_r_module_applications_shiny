<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 7 Développement d’une application Shiny | Développement d’une application Shiny sur l’artificialisation</title>
  <meta name="description" content="Développement pas à pas d’une application Shiny permettant de voir l’évolution de l’artificialisation en région Sud" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 7 Développement d’une application Shiny | Développement d’une application Shiny sur l’artificialisation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Développement pas à pas d’une application Shiny permettant de voir l’évolution de l’artificialisation en région Sud" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 7 Développement d’une application Shiny | Développement d’une application Shiny sur l’artificialisation" />
  
  <meta name="twitter:description" content="Développement pas à pas d’une application Shiny permettant de voir l’évolution de l’artificialisation en région Sud" />
  

<meta name="author" content="Mathieu Rajerison" />


<meta name="date" content="2022-02-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="spatial.html"/>
<link rel="next" href="réflexions.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/d3-3.5.3/d3.min.js"></script>
<link href="libs/colorbrewer-1/colorbrewer.css" rel="stylesheet" />
<script src="libs/colorbrewer-1/colorbrewer.js"></script>
<link href="libs/streamgraph-1/streamgraph.css" rel="stylesheet" />
<script src="libs/streamgraph-binding-0.9.0/streamgraph.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><p style="text-align:center;"><img src="https://mtes-mct.github.io/parcours-r/assets/images/logo_marianne_fond_blanc.png" style="width:100px;"/></p></li>
<li><a href="./index.html">Développement d'une application Shiny</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#le-parcours-de-formation"><i class="fa fa-check"></i><b>0.1</b> Le parcours de formation</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#objectifs-de-ce-module"><i class="fa fa-check"></i><b>0.2</b> Objectifs de ce module</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html"><i class="fa fa-check"></i><b>1</b> Quelques exemples de Datavisualisation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#la-carte-du-choléra-de-john-snow"><i class="fa fa-check"></i><b>1.1</b> La carte du choléra de John Snow</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#charles-joseph-minard"><i class="fa fa-check"></i><b>1.1.1</b> Charles Joseph Minard</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#la-correspondance-de-stefanie-posavec-et-giorgia-lupi"><i class="fa fa-check"></i><b>1.2</b> La correspondance de Stefanie Posavec et Giorgia Lupi</a></li>
<li class="chapter" data-level="1.3" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#le-suivi-de-lépidémie-en-ligne-de-guillaume-rozier"><i class="fa fa-check"></i><b>1.3</b> Le suivi de l’épidémie en ligne de Guillaume Rozier</a></li>
<li class="chapter" data-level="1.4" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#le-data-driven-dj-de-brian-foo"><i class="fa fa-check"></i><b>1.4</b> Le Data-Driven DJ de Brian Foo</a></li>
<li class="chapter" data-level="1.5" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#quelques-théories-et-théoriciens"><i class="fa fa-check"></i><b>1.5</b> Quelques théories et théoriciens</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#jacques-bertin"><i class="fa fa-check"></i><b>1.5.1</b> Jacques Bertin</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#leland-wilkinson"><i class="fa fa-check"></i><b>1.6</b> Leland Wilkinson</a></li>
<li class="chapter" data-level="1.7" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#edward-tufte"><i class="fa fa-check"></i><b>1.7</b> Edward Tufte</a></li>
<li class="chapter" data-level="1.8" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#des-outils-pour-visualiser"><i class="fa fa-check"></i><b>1.8</b> Des outils pour visualiser</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#outils-bureau"><i class="fa fa-check"></i><b>1.8.1</b> Outils bureau</a></li>
<li class="chapter" data-level="1.8.2" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#python"><i class="fa fa-check"></i><b>1.8.2</b> Python</a></li>
<li class="chapter" data-level="1.8.3" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#r"><i class="fa fa-check"></i><b>1.8.3</b> R</a></li>
<li class="chapter" data-level="1.8.4" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#javascript"><i class="fa fa-check"></i><b>1.8.4</b> Javascript</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#des-dataviz-cerema-faites-sous-shiny"><i class="fa fa-check"></i><b>1.9</b> Des dataviz Cerema faites sous Shiny</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#trafic-covid"><i class="fa fa-check"></i><b>1.9.1</b> trafic covid</a></li>
<li class="chapter" data-level="1.9.2" data-path="quelques-exemples-de-datavisualisation.html"><a href="quelques-exemples-de-datavisualisation.html#cartofriches"><i class="fa fa-check"></i><b>1.9.2</b> Cartofriches</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lecture-des-données-de-flux.html"><a href="lecture-des-données-de-flux.html"><i class="fa fa-check"></i><b>2</b> Lecture des données de flux</a>
<ul>
<li class="chapter" data-level="2.1" data-path="lecture-des-données-de-flux.html"><a href="lecture-des-données-de-flux.html#téléchargement-de-la-donnée"><i class="fa fa-check"></i><b>2.1</b> Téléchargement de la donnée</a></li>
<li class="chapter" data-level="2.2" data-path="lecture-des-données-de-flux.html"><a href="lecture-des-données-de-flux.html#chargement-des-librairies"><i class="fa fa-check"></i><b>2.2</b> Chargement des librairies</a></li>
<li class="chapter" data-level="2.3" data-path="lecture-des-données-de-flux.html"><a href="lecture-des-données-de-flux.html#lecture-de-la-donnée"><i class="fa fa-check"></i><b>2.3</b> Lecture de la donnée</a></li>
<li class="chapter" data-level="2.4" data-path="lecture-des-données-de-flux.html"><a href="lecture-des-données-de-flux.html#contrôle"><i class="fa fa-check"></i><b>2.4</b> Contrôle</a></li>
<li class="chapter" data-level="2.5" data-path="lecture-des-données-de-flux.html"><a href="lecture-des-données-de-flux.html#relecture-du-fichier"><i class="fa fa-check"></i><b>2.5</b> Relecture du fichier</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html"><i class="fa fa-check"></i><b>3</b> Traitement de la donnée</a>
<ul>
<li class="chapter" data-level="3.1" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#lecture-des-données"><i class="fa fa-check"></i><b>3.1</b> Lecture des données</a></li>
<li class="chapter" data-level="3.2" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#sélection-des-colonnes"><i class="fa fa-check"></i><b>3.2</b> Sélection des colonnes</a></li>
<li class="chapter" data-level="3.3" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#transformation-du-format-wide-vers-long"><i class="fa fa-check"></i><b>3.3</b> Transformation du format wide vers long</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#wide"><i class="fa fa-check"></i><b>3.3.1</b> Wide</a></li>
<li class="chapter" data-level="3.3.2" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#long"><i class="fa fa-check"></i><b>3.3.2</b> Long</a></li>
<li class="chapter" data-level="3.3.3" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#transformation-au-format-long-avec-gather"><i class="fa fa-check"></i><b>3.3.3</b> Transformation au format <em>long</em> avec <code>gather</code></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#année-et-destination-du-flux"><i class="fa fa-check"></i><b>3.4</b> Année et destination du flux</a></li>
<li class="chapter" data-level="3.5" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#retraitement"><i class="fa fa-check"></i><b>3.5</b> Retraitement</a></li>
<li class="chapter" data-level="3.6" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#fonction-getstatsflux"><i class="fa fa-check"></i><b>3.6</b> Fonction <code>getStatsFlux</code></a></li>
<li class="chapter" data-level="3.7" data-path="traitement-de-la-donnée.html"><a href="traitement-de-la-donnée.html#data-engineering"><i class="fa fa-check"></i><b>3.7</b> Data Engineering</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html"><i class="fa fa-check"></i><b>4</b> Palette de couleurs</a>
<ul>
<li class="chapter" data-level="4.1" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#lecture-des-données-avec-transformation"><i class="fa fa-check"></i><b>4.1</b> Lecture des données avec transformation</a></li>
<li class="chapter" data-level="4.2" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#premier-graphique"><i class="fa fa-check"></i><b>4.2</b> Premier graphique</a></li>
<li class="chapter" data-level="4.3" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#quelques-améliorations"><i class="fa fa-check"></i><b>4.3</b> Quelques améliorations</a></li>
<li class="chapter" data-level="4.4" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#couleurs-hcl-hue-chroma-luminance"><i class="fa fa-check"></i><b>4.4</b> Couleurs HCL (Hue Chroma Luminance)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#a-propos"><i class="fa fa-check"></i><b>4.4.1</b> A propos</a></li>
<li class="chapter" data-level="4.4.2" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#nos-couleurs"><i class="fa fa-check"></i><b>4.4.2</b> Nos couleurs</a></li>
<li class="chapter" data-level="4.4.3" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#assistants"><i class="fa fa-check"></i><b>4.4.3</b> Assistants</a></li>
<li class="chapter" data-level="4.4.4" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#utilisation-dans-notre-graphique"><i class="fa fa-check"></i><b>4.4.4</b> Utilisation dans notre graphique</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#export-de-la-palette"><i class="fa fa-check"></i><b>4.5</b> Export de la palette</a></li>
<li class="chapter" data-level="4.6" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#une-couleur-plus-punchy"><i class="fa fa-check"></i><b>4.6</b> Une couleur plus “punchy”</a></li>
<li class="chapter" data-level="4.7" data-path="palette-de-couleurs.html"><a href="palette-de-couleurs.html#couleurs-cerema"><i class="fa fa-check"></i><b>4.7</b> Couleurs Cerema</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="streamgraph.html"><a href="streamgraph.html"><i class="fa fa-check"></i><b>5</b> Streamgraph</a>
<ul>
<li class="chapter" data-level="5.1" data-path="streamgraph.html"><a href="streamgraph.html#lecture-des-données-1"><i class="fa fa-check"></i><b>5.1</b> Lecture des données</a></li>
<li class="chapter" data-level="5.2" data-path="streamgraph.html"><a href="streamgraph.html#installation-de-la-librairie-streamgraph"><i class="fa fa-check"></i><b>5.2</b> Installation de la librairie <code>streamgraph</code></a></li>
<li class="chapter" data-level="5.3" data-path="streamgraph.html"><a href="streamgraph.html#streamgraph-1"><i class="fa fa-check"></i><b>5.3</b> Streamgraph</a></li>
<li class="chapter" data-level="5.4" data-path="streamgraph.html"><a href="streamgraph.html#fonction-makestream"><i class="fa fa-check"></i><b>5.4</b> Fonction <code>makeStream</code></a></li>
<li class="chapter" data-level="5.5" data-path="streamgraph.html"><a href="streamgraph.html#dimensions-dune-dataviz"><i class="fa fa-check"></i><b>5.5</b> Dimensions d’une dataviz</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>6</b> Spatial</a>
<ul>
<li class="chapter" data-level="6.1" data-path="spatial.html"><a href="spatial.html#librairie-sf"><i class="fa fa-check"></i><b>6.1</b> Librairie sf</a></li>
<li class="chapter" data-level="6.2" data-path="spatial.html"><a href="spatial.html#contours-administratifs"><i class="fa fa-check"></i><b>6.2</b> Contours administratifs</a></li>
<li class="chapter" data-level="6.3" data-path="spatial.html"><a href="spatial.html#export"><i class="fa fa-check"></i><b>6.3</b> Export</a></li>
<li class="chapter" data-level="6.4" data-path="spatial.html"><a href="spatial.html#coordonnées-au-clic"><i class="fa fa-check"></i><b>6.4</b> Coordonnées au clic</a></li>
<li class="chapter" data-level="6.5" data-path="spatial.html"><a href="spatial.html#point"><i class="fa fa-check"></i><b>6.5</b> Point</a></li>
<li class="chapter" data-level="6.6" data-path="spatial.html"><a href="spatial.html#commune-localisée-au-clic"><i class="fa fa-check"></i><b>6.6</b> Commune localisée au clic</a></li>
<li class="chapter" data-level="6.7" data-path="spatial.html"><a href="spatial.html#fonction-getcommcenter"><i class="fa fa-check"></i><b>6.7</b> Fonction <code>getCommCenter</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html"><i class="fa fa-check"></i><b>7</b> Développement d’une application Shiny</a>
<ul>
<li class="chapter" data-level="7.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#préambulle"><i class="fa fa-check"></i><b>7.1</b> Préambulle</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#template-de-base"><i class="fa fa-check"></i><b>7.1.1</b> Template de base</a></li>
<li class="chapter" data-level="7.1.2" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#poser-les-bases"><i class="fa fa-check"></i><b>7.1.2</b> Poser les bases</a></li>
<li class="chapter" data-level="7.1.3" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#lecture-des-données-et-liste-déroulante-des-communes"><i class="fa fa-check"></i><b>7.1.3</b> Lecture des données et liste déroulante des communes</a></li>
<li class="chapter" data-level="7.1.4" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#affiche-un-tableau-des-résultats"><i class="fa fa-check"></i><b>7.1.4</b> Affiche un tableau des résultats</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#dataviz"><i class="fa fa-check"></i><b>7.2</b> Dataviz</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-le-stream"><i class="fa fa-check"></i><b>7.2.1</b> Ajoute le stream</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#contexte"><i class="fa fa-check"></i><b>7.3</b> Contexte</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-les-infos-communales"><i class="fa fa-check"></i><b>7.3.1</b> Ajoute les infos communales</a></li>
<li class="chapter" data-level="7.3.2" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-la-légende"><i class="fa fa-check"></i><b>7.3.2</b> Ajoute la légende</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#charte"><i class="fa fa-check"></i><b>7.4</b> Charte</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#titre-avec-couleurs-cerema"><i class="fa fa-check"></i><b>7.4.1</b> Titre avec couleurs cerema</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#contexte-1"><i class="fa fa-check"></i><b>7.5</b> Contexte</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-la-surface-artificialisée-totale"><i class="fa fa-check"></i><b>7.5.1</b> Ajoute la surface artificialisée totale</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#reactive"><i class="fa fa-check"></i><b>7.6</b> <code>reactive</code></a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajout-de-reactive-fcomm"><i class="fa fa-check"></i><b>7.6.1</b> Ajout de reactive <code>fComm</code></a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#carto"><i class="fa fa-check"></i><b>7.7</b> Carto</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-la-carte-leaflet"><i class="fa fa-check"></i><b>7.7.1</b> Ajoute la carte leaflet</a></li>
<li class="chapter" data-level="7.7.2" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#centre-la-carte-sur-paca"><i class="fa fa-check"></i><b>7.7.2</b> Centre la carte sur PACA</a></li>
<li class="chapter" data-level="7.7.3" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-les-fonds-de-carte"><i class="fa fa-check"></i><b>7.7.3</b> Ajoute les fonds de carte</a></li>
<li class="chapter" data-level="7.7.4" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#coordonnées-au-clic-1"><i class="fa fa-check"></i><b>7.7.4</b> Coordonnées au clic</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#reactive-1"><i class="fa fa-check"></i><b>7.8</b> <code>reactive</code></a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#rend-codeinsee-reactive"><i class="fa fa-check"></i><b>7.8.1</b> Rend codeInsee reactive</a></li>
<li class="chapter" data-level="7.8.2" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-le-reactive"><i class="fa fa-check"></i><b>7.8.2</b> Ajoute le reactive</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#refactoring"><i class="fa fa-check"></i><b>7.9</b> Refactoring</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#fix-ajoute-req"><i class="fa fa-check"></i><b>7.9.1</b> Fix : ajoute req</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#carto-1"><i class="fa fa-check"></i><b>7.10</b> Carto</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-un-marqueur"><i class="fa fa-check"></i><b>7.10.1</b> Ajoute un marqueur</a></li>
<li class="chapter" data-level="7.10.2" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-le-contour-de-la-commune"><i class="fa fa-check"></i><b>7.10.2</b> Ajoute le contour de la commune</a></li>
<li class="chapter" data-level="7.10.3" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#va-vers-la-commune"><i class="fa fa-check"></i><b>7.10.3</b> Va vers la commune</a></li>
<li class="chapter" data-level="7.10.4" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#la-liste-déroulante-permet-daller-vers-une-commune"><i class="fa fa-check"></i><b>7.10.4</b> La liste déroulante permet d’aller vers une commune</a></li>
<li class="chapter" data-level="7.10.5" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-lélément-vide-à-la-liste-des-communes"><i class="fa fa-check"></i><b>7.10.5</b> Ajoute l’élément vide à la liste des communes</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#refactoring-1"><i class="fa fa-check"></i><b>7.11</b> Refactoring</a>
<ul>
<li class="chapter" data-level="7.11.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#précise-quil-faut-cliquer-sur-la-carte-pour-afficher-les-stats"><i class="fa fa-check"></i><b>7.11.1</b> Précise qu’il faut cliquer sur la carte pour afficher les stats</a></li>
</ul></li>
<li class="chapter" data-level="7.12" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#dataviz-1"><i class="fa fa-check"></i><b>7.12</b> Dataviz</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-la-treemap-et-supprime-la-légende"><i class="fa fa-check"></i><b>7.12.1</b> Ajoute la treemap et supprime la légende</a></li>
</ul></li>
<li class="chapter" data-level="7.13" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#refactoring-2"><i class="fa fa-check"></i><b>7.13</b> Refactoring</a>
<ul>
<li class="chapter" data-level="7.13.1" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#sépare-en-ui.r-server.r-et-global.r"><i class="fa fa-check"></i><b>7.13.1</b> Sépare en <code>ui.R</code>, <code>server.R</code> et <code>global.R</code></a></li>
<li class="chapter" data-level="7.13.2" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#au-sujet-de-global.r"><i class="fa fa-check"></i><b>7.13.2</b> Au sujet de <code>global.R</code></a></li>
<li class="chapter" data-level="7.13.3" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#global.r"><i class="fa fa-check"></i><b>7.13.3</b> <code>global.R</code></a></li>
<li class="chapter" data-level="7.13.4" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#ajoute-un-fichier-helpers.r"><i class="fa fa-check"></i><b>7.13.4</b> Ajoute un fichier <code>helpers.R</code></a></li>
<li class="chapter" data-level="7.13.5" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#global.r-1"><i class="fa fa-check"></i><b>7.13.5</b> <code>global.R</code></a></li>
</ul></li>
<li class="chapter" data-level="7.14" data-path="développement-dune-application-shiny.html"><a href="développement-dune-application-shiny.html#contexte-2"><i class="fa fa-check"></i><b>7.14</b> Contexte</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="réflexions.html"><a href="réflexions.html"><i class="fa fa-check"></i><b>8</b> Réflexions</a>
<ul>
<li class="chapter" data-level="8.1" data-path="réflexions.html"><a href="réflexions.html#data-centric"><i class="fa fa-check"></i><b>8.1</b> Data centric</a></li>
<li class="chapter" data-level="8.2" data-path="réflexions.html"><a href="réflexions.html#les-étapes-de-développement-dune-dataviz"><i class="fa fa-check"></i><b>8.2</b> Les étapes de développement d’une dataviz</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="réflexions.html"><a href="réflexions.html#collecte"><i class="fa fa-check"></i><b>8.2.1</b> Collecte</a></li>
<li class="chapter" data-level="8.2.2" data-path="réflexions.html"><a href="réflexions.html#qualité"><i class="fa fa-check"></i><b>8.2.2</b> Qualité</a></li>
<li class="chapter" data-level="8.2.3" data-path="réflexions.html"><a href="réflexions.html#sémiologie"><i class="fa fa-check"></i><b>8.2.3</b> Sémiologie</a></li>
<li class="chapter" data-level="8.2.4" data-path="réflexions.html"><a href="réflexions.html#expérience-utilisateur"><i class="fa fa-check"></i><b>8.2.4</b> Expérience utilisateur</a></li>
<li class="chapter" data-level="8.2.5" data-path="réflexions.html"><a href="réflexions.html#fonctionnalité"><i class="fa fa-check"></i><b>8.2.5</b> Fonctionnalité</a></li>
<li class="chapter" data-level="8.2.6" data-path="réflexions.html"><a href="réflexions.html#esthétique"><i class="fa fa-check"></i><b>8.2.6</b> Esthétique</a></li>
<li class="chapter" data-level="8.2.7" data-path="réflexions.html"><a href="réflexions.html#refactoring-3"><i class="fa fa-check"></i><b>8.2.7</b> Refactoring</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="réflexions.html"><a href="réflexions.html#dimensions-dune-dataviz-1"><i class="fa fa-check"></i><b>8.3</b> Dimensions d’une dataviz</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://mtes-mct.github.io/parcours-r/">Liste des formations R</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Développement d’une application Shiny sur l’artificialisation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="développement-dune-application-shiny" class="section level1" number="7">
<h1><span class="header-section-number">Chapitre 7</span> Développement d’une application Shiny</h1>
<p>Cette animation montre l’évolution de l’application depuis le premier commit jusqu’au dernier.</p>
<p>Nous partons d’une représentation assez basique (poser les bases) vers l’ajout progressif d’éléments d’interaction utilisateur, de représentation de la données, ainsi que d’éléments contextuels textes.</p>
<p>Cette animation montre l’évolution de l’appli depuis le premier commit jusqu’au dernier :
<img src="files/shinyapp/gif/animation.gif" /></p>
<p>Le code de l’application est accessible dans le répertoire github <a href="https://github.com/datagistips/shiny-artif0920-app">shiny-artif-app</a>.</p>
<div id="préambulle" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Préambulle</h2>
<div id="template-de-base" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Template de base</h3>
<p>Pour créer une application Shiny, il faut, depuis <a href="https://www.rstudio.com/products/rstudio/download/">RStudio</a>, aller dans <code>File &gt; New File &gt; Shiny Web App...</code></p>
<p><img src="files/create-shiny.png" /></p>
<p>Cela crée une application basique qui sert d’exemple, avec une liste déroulante et un graphique d’exemple :
<img src="files/base-app.png" /></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="développement-dune-application-shiny.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb72-2"><a href="développement-dune-application-shiny.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="développement-dune-application-shiny.html#cb72-3" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb72-4"><a href="développement-dune-application-shiny.html#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="développement-dune-application-shiny.html#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Application title</span></span>
<span id="cb72-6"><a href="développement-dune-application-shiny.html#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">&quot;Old Faithful Geyser Data&quot;</span>), <span class="do">## on changera le nom de l&#39;appli plus tard</span></span>
<span id="cb72-7"><a href="développement-dune-application-shiny.html#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="développement-dune-application-shiny.html#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb72-9"><a href="développement-dune-application-shiny.html#cb72-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb72-10"><a href="développement-dune-application-shiny.html#cb72-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;liste&quot;</span></span>
<span id="cb72-11"><a href="développement-dune-application-shiny.html#cb72-11" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb72-12"><a href="développement-dune-application-shiny.html#cb72-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mainPanel</span>(</span>
<span id="cb72-13"><a href="développement-dune-application-shiny.html#cb72-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;résultats&quot;</span></span>
<span id="cb72-14"><a href="développement-dune-application-shiny.html#cb72-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb72-15"><a href="développement-dune-application-shiny.html#cb72-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb72-16"><a href="développement-dune-application-shiny.html#cb72-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-17"><a href="développement-dune-application-shiny.html#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="développement-dune-application-shiny.html#cb72-18" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb72-19"><a href="développement-dune-application-shiny.html#cb72-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## vide pour le moment</span></span>
<span id="cb72-20"><a href="développement-dune-application-shiny.html#cb72-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-21"><a href="développement-dune-application-shiny.html#cb72-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-22"><a href="développement-dune-application-shiny.html#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Run the application </span></span>
<span id="cb72-23"><a href="développement-dune-application-shiny.html#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<ul>
<li><code>ui</code> est la partie destinée à accueillir les éléments d’interface (esthétique)</li>
<li><code>server</code> est la partie dans laquelle seront définis les mécanismes d’interaction, d’interrogation et de représentation des données. La partie <code>server</code> réagit aux contrôles (slider, boutons, …) définis dans <code>ui</code></li>
</ul>
<p><img src="files/ui-server/1.jpg" /></p>
<p>Dans l’exemple d’application de base proposée par RStudio, le plot réagit au nombre de bins (barres) défini par un slider. Ainsi, on a cette interaction :</p>
<p><img src="files/ui-server/2.jpg" /></p>
<blockquote>
<p>En quelque sorte, par analogie avec un modèle MVC (Modèle Vue Contrôleur), <code>ui</code> concerne la Vue et <code>server</code> le Contrôleur.</p>
</blockquote>
<p>Dans tous les cas, on a cette modélisation pour les contrôles, sorties dans Shiny :</p>
<p><img src="files/ui-server/3.jpg" /></p>
<ul>
<li>un <code>renderStreamgraph</code> pourra réagir à un input de <code>ui</code>, et sera rendu dans <code>ui</code> sous la forme de <code>streamgraphOutput</code></li>
<li>un <code>renderText</code> aura son pendant <code>textOutput</code></li>
<li>etc…</li>
</ul>
<p>Ce sont les mêmes conventions qui sont utilisées.</p>
<p>On a des <code>inputs</code>, des fonctions <code>render</code>, et des <code>outputs</code></p>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/006bc70d801a290ef1771b69cd2ded14e0b12516">Voir cette version</a> (006bc70d801a290ef1771b69cd2ded14e0b12516)</p>
</div>
<div id="poser-les-bases" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Poser les bases</h3>
<p>Dans un premier temps, on pose les bases, et on efface certains éléments de l’application d’exemple.</p>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/414c6942ce44edd411e256ab0295bb50de2fa059">Voir cette version</a> (414c6942ce44edd411e256ab0295bb50de2fa059)</p>
<p><code>server.R</code>
La partie est laissée vide pour le moment :</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="développement-dune-application-shiny.html#cb73-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb73-2"><a href="développement-dune-application-shiny.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="do">## vide</span></span>
<span id="cb73-3"><a href="développement-dune-application-shiny.html#cb73-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="lecture-des-données-et-liste-déroulante-des-communes" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Lecture des données et liste déroulante des communes</h3>
<p><img src="files/snapshots/liste.png" /></p>
<p>On lit les données de flux :</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="développement-dune-application-shiny.html#cb74-1" aria-hidden="true" tabindex="-1"></a>flux <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/obs_artif_conso_com_2009_2020_V2.csv&quot;</span>, <span class="at">na =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NULL&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="développement-dune-application-shiny.html#cb74-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(idreg <span class="sc">==</span> <span class="st">&quot;93&quot;</span>)</span></code></pre></div>
<p>Ainsi que les données communales :</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="développement-dune-application-shiny.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Contours de communes</span></span>
<span id="cb75-2"><a href="développement-dune-application-shiny.html#cb75-2" aria-hidden="true" tabindex="-1"></a>comms <span class="ot">&lt;&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/comms.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="développement-dune-application-shiny.html#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(INSEE_REG <span class="sc">==</span> <span class="dv">93</span>)</span>
<span id="cb75-4"><a href="développement-dune-application-shiny.html#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="développement-dune-application-shiny.html#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Liste communes</span></span>
<span id="cb75-6"><a href="développement-dune-application-shiny.html#cb75-6" aria-hidden="true" tabindex="-1"></a>communes <span class="ot">&lt;-</span> flux<span class="sc">$</span>idcom</span>
<span id="cb75-7"><a href="développement-dune-application-shiny.html#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(communes) <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&quot;{flux$idcomtxt} ({flux$idcom})&quot;</span>)</span></code></pre></div>
<p><code>ui.R</code>
On ajoute la liste déroulante des communes maintenant qu’elles ont été lues :</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="développement-dune-application-shiny.html#cb76-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb76-2"><a href="développement-dune-application-shiny.html#cb76-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb76-3"><a href="développement-dune-application-shiny.html#cb76-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">selectInput</span>(<span class="st">&quot;communes&quot;</span>, <span class="at">label =</span> <span class="cn">NULL</span>, <span class="at">choices =</span> communes, <span class="at">selected =</span> <span class="cn">NULL</span>),</span>
<span id="cb76-4"><a href="développement-dune-application-shiny.html#cb76-4" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb76-5"><a href="développement-dune-application-shiny.html#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="développement-dune-application-shiny.html#cb76-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mainPanel</span>(</span>
<span id="cb76-7"><a href="développement-dune-application-shiny.html#cb76-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Résultats&quot;</span></span>
<span id="cb76-8"><a href="développement-dune-application-shiny.html#cb76-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb76-9"><a href="développement-dune-application-shiny.html#cb76-9" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/9c271b706e34afff002b6e6d5df7ef895af1907e">Voir cette version</a> (9c271b706e34afff002b6e6d5df7ef895af1907e)</p>
</div>
<div id="affiche-un-tableau-des-résultats" class="section level3" number="7.1.4">
<h3><span class="header-section-number">7.1.4</span> Affiche un tableau des résultats</h3>
<p><img src="files/snapshots/tableau.png" /></p>
<p>On peut afficher un tableau des résultats de flux pour une commune sélectionnée, juste pour tester les mécanismes de sélection, notamment la fonction <code>getStatsFlux</code> vue dans un précédent notebook.</p>
<p><code>ui.R</code></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="développement-dune-application-shiny.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mainPanel</span>(</span>
<span id="cb77-2"><a href="développement-dune-application-shiny.html#cb77-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">dataTableOutput</span>(<span class="st">&quot;tbResults&quot;</span>)</span>
<span id="cb77-3"><a href="développement-dune-application-shiny.html#cb77-3" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><code>server.R</code>
On ajoute les résultats avec <code>renderDataTable</code> et <code>dataTableOutput</code> :</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="développement-dune-application-shiny.html#cb78-1" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>tbResults <span class="ot">&lt;-</span> <span class="fu">renderDataTable</span>({</span>
<span id="cb78-2"><a href="développement-dune-application-shiny.html#cb78-2" aria-hidden="true" tabindex="-1"></a>        codeInsee <span class="ot">&lt;-</span> input<span class="sc">$</span>communes</span>
<span id="cb78-3"><a href="développement-dune-application-shiny.html#cb78-3" aria-hidden="true" tabindex="-1"></a>        df <span class="ot">&lt;-</span> flux <span class="sc">%&gt;%</span> <span class="fu">getStatsFlux</span>(codeInsee)</span>
<span id="cb78-4"><a href="développement-dune-application-shiny.html#cb78-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(df)</span>
<span id="cb78-5"><a href="développement-dune-application-shiny.html#cb78-5" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/64c7a25268157cf832c9b57dc71b7dfffd663d9e">Voir cette version</a> (64c7a25268157cf832c9b57dc71b7dfffd663d9e)</p>
</div>
</div>
<div id="dataviz" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Dataviz</h2>
<div id="ajoute-le-stream" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Ajoute le stream</h3>
<p><img src="files/snapshots/stream.png" /></p>
<p>On ajoute le streamgraph.</p>
<p><code>ui.R</code></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="développement-dune-application-shiny.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mainPanel</span>(</span>
<span id="cb79-2"><a href="développement-dune-application-shiny.html#cb79-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">streamgraphOutput</span>(<span class="st">&quot;streamPlot&quot;</span>)</span>
<span id="cb79-3"><a href="développement-dune-application-shiny.html#cb79-3" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><code>server.R</code></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="développement-dune-application-shiny.html#cb80-1" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>streamPlot <span class="ot">&lt;-</span> <span class="fu">renderStreamgraph</span>({</span>
<span id="cb80-2"><a href="développement-dune-application-shiny.html#cb80-2" aria-hidden="true" tabindex="-1"></a>        myStream <span class="ot">&lt;-</span> flux <span class="sc">%&gt;%</span> <span class="fu">makeStream</span>(codeInsee)</span>
<span id="cb80-3"><a href="développement-dune-application-shiny.html#cb80-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(myStream)</span>
<span id="cb80-4"><a href="développement-dune-application-shiny.html#cb80-4" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/a402e8385afcf0c350ac0841037a69383e85eace">Voir cette version</a> (a402e8385afcf0c350ac0841037a69383e85eace)</p>
</div>
</div>
<div id="contexte" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Contexte</h2>
<div id="ajoute-les-infos-communales" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Ajoute les infos communales</h3>
<p><img src="files/snapshots/texte.png" /></p>
<p>On peut ajouter des informations assez sommaires sur la commune sélectionnée, sous la forme de texte.</p>
<p><code>ui.R</code></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="développement-dune-application-shiny.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mainPanel</span>(</span>
<span id="cb81-2"><a href="développement-dune-application-shiny.html#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textOutput</span>(<span class="st">&quot;txtCommune&quot;</span>),</span>
<span id="cb81-3"><a href="développement-dune-application-shiny.html#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">streamgraphOutput</span>(<span class="st">&quot;streamPlot&quot;</span>)</span>
<span id="cb81-4"><a href="développement-dune-application-shiny.html#cb81-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><code>server.R</code></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="développement-dune-application-shiny.html#cb82-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>txtCommune <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb82-2"><a href="développement-dune-application-shiny.html#cb82-2" aria-hidden="true" tabindex="-1"></a>    codeInsee <span class="ot">&lt;-</span> input<span class="sc">$</span>communes</span>
<span id="cb82-3"><a href="développement-dune-application-shiny.html#cb82-3" aria-hidden="true" tabindex="-1"></a>    fComm <span class="ot">&lt;-</span> flux <span class="sc">%&gt;%</span> <span class="fu">filter</span>(idcom <span class="sc">==</span> codeInsee)</span>
<span id="cb82-4"><a href="développement-dune-application-shiny.html#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="développement-dune-application-shiny.html#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(fComm<span class="sc">$</span>idcomtxt, fComm<span class="sc">$</span>idcom, fComm<span class="sc">$</span>artcom0920)</span>
<span id="cb82-6"><a href="développement-dune-application-shiny.html#cb82-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/602a3ea312be829aca7146e5563c001cdd33e823">Voir cette version</a> (602a3ea312be829aca7146e5563c001cdd33e823)</p>
</div>
<div id="ajoute-la-légende" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Ajoute la légende</h3>
<p><img src="files/snapshots/legende.png" /></p>
<p><code>server.R</code>
Pour la légende, on utilise simplement de l’HTML stylisé, plutôt que la légende du plot.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="développement-dune-application-shiny.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tagList</span>(</span>
<span id="cb83-2"><a href="développement-dune-application-shiny.html#cb83-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">div</span>(</span>
<span id="cb83-3"><a href="développement-dune-application-shiny.html#cb83-3" aria-hidden="true" tabindex="-1"></a>                myStream,</span>
<span id="cb83-4"><a href="développement-dune-application-shiny.html#cb83-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">style=</span><span class="st">&quot;margin-bottom:20px;&quot;</span></span>
<span id="cb83-5"><a href="développement-dune-application-shiny.html#cb83-5" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb83-6"><a href="développement-dune-application-shiny.html#cb83-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">div</span>(</span>
<span id="cb83-7"><a href="développement-dune-application-shiny.html#cb83-7" aria-hidden="true" tabindex="-1"></a>                tags<span class="sc">$</span><span class="fu">span</span>(<span class="st">&quot;Habitat&quot;</span>,</span>
<span id="cb83-8"><a href="développement-dune-application-shiny.html#cb83-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style =</span> <span class="fu">glue</span>(<span class="st">&quot;background-color:{myPalette[&#39;blue&#39;]};padding:10px;&quot;</span>)),</span>
<span id="cb83-9"><a href="développement-dune-application-shiny.html#cb83-9" aria-hidden="true" tabindex="-1"></a>                tags<span class="sc">$</span><span class="fu">span</span>(<span class="st">&quot;Activité&quot;</span>,</span>
<span id="cb83-10"><a href="développement-dune-application-shiny.html#cb83-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style =</span> <span class="fu">glue</span>(<span class="st">&quot;background-color:{myPalette[&#39;red&#39;]};padding:10px;&quot;</span>)),</span>
<span id="cb83-11"><a href="développement-dune-application-shiny.html#cb83-11" aria-hidden="true" tabindex="-1"></a>                tags<span class="sc">$</span><span class="fu">span</span>(<span class="st">&quot;Mixte&quot;</span>,</span>
<span id="cb83-12"><a href="développement-dune-application-shiny.html#cb83-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style =</span> <span class="fu">glue</span>(<span class="st">&quot;background-color:{myPalette[&#39;magenta&#39;]};padding:10px;&quot;</span>)),</span>
<span id="cb83-13"><a href="développement-dune-application-shiny.html#cb83-13" aria-hidden="true" tabindex="-1"></a>                tags<span class="sc">$</span><span class="fu">span</span>(<span class="st">&quot;Inconnu&quot;</span>,</span>
<span id="cb83-14"><a href="développement-dune-application-shiny.html#cb83-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style =</span> <span class="fu">glue</span>(<span class="st">&quot;background-color:{myPalette[&#39;grey&#39;]};padding:10px;&quot;</span>)),</span>
<span id="cb83-15"><a href="développement-dune-application-shiny.html#cb83-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">style=</span><span class="st">&quot;text-align:center&quot;</span></span>
<span id="cb83-16"><a href="développement-dune-application-shiny.html#cb83-16" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb83-17"><a href="développement-dune-application-shiny.html#cb83-17" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p>On peut faire du HTML assez avancé avec R Shiny !</p>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/9c2ab647d7d7376fa84ee19b3239822260933d77">Voir cette version</a> (9c2ab647d7d7376fa84ee19b3239822260933d77)</p>
</div>
</div>
<div id="charte" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Charte</h2>
<div id="titre-avec-couleurs-cerema" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Titre avec couleurs cerema</h3>
<p><img src="files/snapshots/couleurs.png" /></p>
<p>Ici, on intègre un élément de charte graphique Cerema, notamment la palette graphique de l’établissement au format JSON.</p>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/c1868418f645a374a8bfda9a3fb11bc0d72a18ec">Voir cette version</a> (c1868418f645a374a8bfda9a3fb11bc0d72a18ec)</p>
</div>
</div>
<div id="contexte-1" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Contexte</h2>
<div id="ajoute-la-surface-artificialisée-totale" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Ajoute la surface artificialisée totale</h3>
<p>On ajoute une nouvelle information en texte.</p>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/9c6f9bed953ea15b948fa371a1d988df5acd27ee">Voir cette version</a> (9c6f9bed953ea15b948fa371a1d988df5acd27ee)</p>
</div>
</div>
<div id="reactive" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> <code>reactive</code></h2>
<div id="ajout-de-reactive-fcomm" class="section level3" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> Ajout de reactive <code>fComm</code></h3>
<p>Les variables de type <code>reactive</code> sont très utiles lorsqu’il s’agit de récupérer à plusieurs endroits le résultat d’une variable calculée car cela évite, entre autres, de devoir répliquer les mécanismes de création de cette variable à ces multiples endroits. Aussi, un mécanisme interne permet de ne pas recalculer la variable si elle n’a pas changé avec les nouveaux critères de création.</p>
<p><code>server.R</code></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="développement-dune-application-shiny.html#cb84-1" aria-hidden="true" tabindex="-1"></a>fComm <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb84-2"><a href="développement-dune-application-shiny.html#cb84-2" aria-hidden="true" tabindex="-1"></a>    fComm <span class="ot">&lt;-</span> flux <span class="sc">%&gt;%</span> <span class="fu">filter</span>(idcom <span class="sc">==</span> input<span class="sc">$</span>communes)</span>
<span id="cb84-3"><a href="développement-dune-application-shiny.html#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fComm)</span>
<span id="cb84-4"><a href="développement-dune-application-shiny.html#cb84-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>On peut récupérer les variables comme ceci :</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="développement-dune-application-shiny.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fComm</span>()<span class="sc">$</span>artcom0920</span>
<span id="cb85-2"><a href="développement-dune-application-shiny.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fComm</span>()<span class="sc">$</span>nafart0920</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/739307b7430ab0d52f3c241fd16d4404c80c927b">Voir cette version</a> (739307b7430ab0d52f3c241fd16d4404c80c927b)</p>
</div>
</div>
<div id="carto" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Carto</h2>
<div id="ajoute-la-carte-leaflet" class="section level3" number="7.7.1">
<h3><span class="header-section-number">7.7.1</span> Ajoute la carte leaflet</h3>
<p><img src="files/snapshots/carte.png" /></p>
<p><code>ui.R</code></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="développement-dune-application-shiny.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leafletOutput</span>(<span class="st">&quot;mymap&quot;</span>)</span></code></pre></div>
<p><code>server.R</code></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="développement-dune-application-shiny.html#cb87-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>mymap <span class="ot">&lt;-</span> <span class="fu">renderLeaflet</span>({</span>
<span id="cb87-2"><a href="développement-dune-application-shiny.html#cb87-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="développement-dune-application-shiny.html#cb87-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">addTiles</span>(<span class="at">group =</span> <span class="st">&quot;OSM&quot;</span>)</span>
<span id="cb87-4"><a href="développement-dune-application-shiny.html#cb87-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/5e5be7cf03e9ad4d145c292477d958af00f76904">Voir cette version</a> (5e5be7cf03e9ad4d145c292477d958af00f76904)</p>
</div>
<div id="centre-la-carte-sur-paca" class="section level3" number="7.7.2">
<h3><span class="header-section-number">7.7.2</span> Centre la carte sur PACA</h3>
<p><img src="files/snapshots/paca.png" /></p>
<p><code>server.R</code>
Pour ajuster la carte sur PACA, on utile la fonction <code>fitBounds</code>.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="développement-dune-application-shiny.html#cb88-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>mymap <span class="ot">&lt;-</span> <span class="fu">renderLeaflet</span>({</span>
<span id="cb88-2"><a href="développement-dune-application-shiny.html#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="développement-dune-application-shiny.html#cb88-3" aria-hidden="true" tabindex="-1"></a>        bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(comms) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb88-4"><a href="développement-dune-application-shiny.html#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="développement-dune-application-shiny.html#cb88-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb88-6"><a href="développement-dune-application-shiny.html#cb88-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">addTiles</span>(<span class="at">group =</span> <span class="st">&quot;OSM&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-7"><a href="développement-dune-application-shiny.html#cb88-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fitBounds</span>(<span class="at">lng1 =</span> bb[<span class="dv">1</span>], </span>
<span id="cb88-8"><a href="développement-dune-application-shiny.html#cb88-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lat1 =</span> bb[<span class="dv">2</span>], </span>
<span id="cb88-9"><a href="développement-dune-application-shiny.html#cb88-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lng2 =</span> bb[<span class="dv">3</span>], </span>
<span id="cb88-10"><a href="développement-dune-application-shiny.html#cb88-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lat2 =</span> bb[<span class="dv">4</span>])</span>
<span id="cb88-11"><a href="développement-dune-application-shiny.html#cb88-11" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/593b2972d14ee8f0f044fb43b2abc41932c4b1ab">Voir cette version</a> (593b2972d14ee8f0f044fb43b2abc41932c4b1ab)</p>
</div>
<div id="ajoute-les-fonds-de-carte" class="section level3" number="7.7.3">
<h3><span class="header-section-number">7.7.3</span> Ajoute les fonds de carte</h3>
<p><img src="files/snapshots/fonds.png" /></p>
<p>Ajoutons davantage de fonds cartos, notamment ceux de l’IGN : orthophoto, Plan IGN.</p>
<p><code>server.R</code></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="développement-dune-application-shiny.html#cb89-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>mymap <span class="ot">&lt;-</span> <span class="fu">renderLeaflet</span>({</span>
<span id="cb89-2"><a href="développement-dune-application-shiny.html#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="développement-dune-application-shiny.html#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-4"><a href="développement-dune-application-shiny.html#cb89-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">addTiles</span>(<span class="at">group =</span> <span class="st">&quot;OSM&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="développement-dune-application-shiny.html#cb89-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">addProviderTiles</span>(providers<span class="sc">$</span>CartoDB.PositronOnlyLabels, <span class="at">group =</span> <span class="st">&quot;Villes&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb89-6"><a href="développement-dune-application-shiny.html#cb89-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">addTiles</span>(<span class="st">&quot;http://wxs.ign.fr/choisirgeoportail/wmts?REQUEST=GetTile&amp;SERVICE=WMTS&amp;VERSION=1.0.0&amp;STYLE=normal&amp;TILEMATRIXSET=PM&amp;FORMAT=image/png&amp;LAYER=GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2&amp;TILEMATRIX={z}&amp;TILEROW={y}&amp;TILECOL={x}&quot;</span>,</span>
<span id="cb89-7"><a href="développement-dune-application-shiny.html#cb89-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">options =</span> <span class="fu">c</span>(<span class="fu">WMSTileOptions</span>(<span class="at">tileSize =</span> <span class="dv">256</span>),</span>
<span id="cb89-8"><a href="développement-dune-application-shiny.html#cb89-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">providerTileOptions</span>(<span class="at">minZoom =</span> <span class="dv">1</span>, <span class="at">maxZoom =</span> <span class="dv">15</span>)),</span>
<span id="cb89-9"><a href="développement-dune-application-shiny.html#cb89-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">attribution=</span><span class="st">&#39;&lt;a target=&quot;_blank&quot; href=&quot;https://www.geoportail.gouv.fr/&quot;&gt;Geoportail France&lt;/a&gt;&#39;</span>,</span>
<span id="cb89-10"><a href="développement-dune-application-shiny.html#cb89-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> <span class="st">&quot;Plan IGN&quot;</span></span>
<span id="cb89-11"><a href="développement-dune-application-shiny.html#cb89-11" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb89-12"><a href="développement-dune-application-shiny.html#cb89-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">addTiles</span>(<span class="st">&quot;http://wxs.ign.fr/choisirgeoportail/wmts?REQUEST=GetTile&amp;SERVICE=WMTS&amp;VERSION=1.0.0&amp;STYLE=normal&amp;TILEMATRIXSET=PM&amp;FORMAT=image/jpeg&amp;LAYER=ORTHOIMAGERY.ORTHOPHOTOS&amp;TILEMATRIX={z}&amp;TILEROW={y}&amp;TILECOL={x}&quot;</span>,</span>
<span id="cb89-13"><a href="développement-dune-application-shiny.html#cb89-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">options =</span> <span class="fu">c</span>(<span class="fu">WMSTileOptions</span>(<span class="at">tileSize =</span> <span class="dv">256</span>),</span>
<span id="cb89-14"><a href="développement-dune-application-shiny.html#cb89-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">providerTileOptions</span>(<span class="at">minZoom =</span> <span class="dv">1</span>, <span class="at">maxZoom =</span> <span class="dv">22</span>)),</span>
<span id="cb89-15"><a href="développement-dune-application-shiny.html#cb89-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">attribution=</span><span class="st">&#39;&lt;a target=&quot;_blank&quot; href=&quot;https://www.geoportail.gouv.fr/&quot;&gt;Geoportail France&lt;/a&gt;&#39;</span>,</span>
<span id="cb89-16"><a href="développement-dune-application-shiny.html#cb89-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> <span class="st">&quot;Photo aérienne&quot;</span></span>
<span id="cb89-17"><a href="développement-dune-application-shiny.html#cb89-17" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb89-18"><a href="développement-dune-application-shiny.html#cb89-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">addLayersControl</span>(<span class="at">baseGroups    =</span> <span class="fu">c</span>(<span class="st">&quot;Photo aérienne&quot;</span>, <span class="st">&quot;Plan IGN&quot;</span>, <span class="st">&quot;OSM&quot;</span>),</span>
<span id="cb89-19"><a href="développement-dune-application-shiny.html#cb89-19" aria-hidden="true" tabindex="-1"></a>                             <span class="at">overlayGroups =</span> <span class="st">&quot;Villes&quot;</span>,</span>
<span id="cb89-20"><a href="développement-dune-application-shiny.html#cb89-20" aria-hidden="true" tabindex="-1"></a>                             <span class="at">options       =</span> <span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb89-21"><a href="développement-dune-application-shiny.html#cb89-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fitBounds</span>(<span class="at">lng1 =</span> bb[<span class="dv">1</span>], <span class="at">lat1 =</span> bb[<span class="dv">2</span>], <span class="at">lng2 =</span> bb[<span class="dv">3</span>], <span class="at">lat2 =</span> bb[<span class="dv">4</span>])</span>
<span id="cb89-22"><a href="développement-dune-application-shiny.html#cb89-22" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/fb67dcc4b87bc13a8cb81847be5c4d5aee1e2b95">Voir cette version</a> (fb67dcc4b87bc13a8cb81847be5c4d5aee1e2b95)</p>
</div>
<div id="coordonnées-au-clic-1" class="section level3" number="7.7.4">
<h3><span class="header-section-number">7.7.4</span> Coordonnées au clic</h3>
<p><img src="files/snapshots/verbatim.png" /></p>
<p>Pour trouver les coordonnées au clic, on utile un mécanisme de sélection basé sur input, notamment input$mymap.</p>
<blockquote>
<p>A noter que l’on peut aussi réagir au clic sur une entité (<code>input$mymap_shape_click</code>), voire au passage (<code>input$mymap_shape_mouseover</code>). <a href="https://rstudio.github.io/leaflet/shiny.html#inputsevents">Voir à ce titre la page dédiée sur R Leaflet</a>.</p>
</blockquote>
<p><code>ui.R</code></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="développement-dune-application-shiny.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">verbatimTextOutput</span>(<span class="st">&quot;foo&quot;</span>)</span></code></pre></div>
<p><code>server.R</code></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="développement-dune-application-shiny.html#cb91-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>foo <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb91-2"><a href="développement-dune-application-shiny.html#cb91-2" aria-hidden="true" tabindex="-1"></a>    input<span class="sc">$</span>mymap_click</span>
<span id="cb91-3"><a href="développement-dune-application-shiny.html#cb91-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/a9fd41bd65be309d9a5c9e37835bad164ee9b37c">Voir cette version</a> (a9fd41bd65be309d9a5c9e37835bad164ee9b37c)</p>
</div>
</div>
<div id="reactive-1" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> <code>reactive</code></h2>
<div id="rend-codeinsee-reactive" class="section level3" number="7.8.1">
<h3><span class="header-section-number">7.8.1</span> Rend codeInsee reactive</h3>
<p>Le code INSEE est récupéré dynamiquement après un clic sur la carte.</p>
<p>On rend le code INSEE reactive car il sera utilisé à plusieurs endroits : <a href="https://github.com/datagistips/shiny-artif-app/commit/1edc95aebfe35df74ca77370b78dc1d0402157a6#diff-ee89f65a0b4e0dccabce1672d6d689b4e2b6ca51ea1e746bdda1eca94aaa6e0fR252">ici</a> ou encore <a href="https://github.com/datagistips/shiny-artif-app/commit/1edc95aebfe35df74ca77370b78dc1d0402157a6#diff-ee89f65a0b4e0dccabce1672d6d689b4e2b6ca51ea1e746bdda1eca94aaa6e0fR276">là</a></p>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/4ac477bd273eaf5db7b0511764c9555182ef423e">Voir cette version</a> (4ac477bd273eaf5db7b0511764c9555182ef423e)</p>
</div>
<div id="ajoute-le-reactive" class="section level3" number="7.8.2">
<h3><span class="header-section-number">7.8.2</span> Ajoute le reactive</h3>
<p>On peut créer des reactive en cascade, comme ici, pour <code>fComm()</code> qui s’appuie sur <code>codeInsee()</code></p>
<p><code>server.R</code></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="développement-dune-application-shiny.html#cb92-1" aria-hidden="true" tabindex="-1"></a>fComm <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb92-2"><a href="développement-dune-application-shiny.html#cb92-2" aria-hidden="true" tabindex="-1"></a>        fComm <span class="ot">&lt;-</span> flux <span class="sc">%&gt;%</span> <span class="fu">filter</span>(idcom <span class="sc">==</span> input<span class="sc">$</span>communes)</span>
<span id="cb92-3"><a href="développement-dune-application-shiny.html#cb92-3" aria-hidden="true" tabindex="-1"></a>        fComm <span class="ot">&lt;-</span> flux <span class="sc">%&gt;%</span> <span class="fu">filter</span>(idcom <span class="sc">==</span> <span class="fu">codeInsee</span>())</span>
<span id="cb92-4"><a href="développement-dune-application-shiny.html#cb92-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(fComm)</span>
<span id="cb92-5"><a href="développement-dune-application-shiny.html#cb92-5" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>Pour le streamgraph, on utilise <code>codeInsee()</code> comme ceci :</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="développement-dune-application-shiny.html#cb93-1" aria-hidden="true" tabindex="-1"></a>myStream <span class="ot">&lt;-</span> flux <span class="sc">%&gt;%</span> <span class="fu">makeStream</span>(<span class="fu">codeInsee</span>())</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/f3d3ffb842c07aaa67a9e4c48b922e8b4fa858dc#diff-ee89f65a0b4e0dccabce1672d6d689b4e2b6ca51ea1e746bdda1eca94aaa6e0fR174">Voir la ligne de code</a></p>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/f3d3ffb842c07aaa67a9e4c48b922e8b4fa858dc">Voir cette version</a> (f3d3ffb842c07aaa67a9e4c48b922e8b4fa858dc)</p>
</div>
</div>
<div id="refactoring" class="section level2" number="7.9">
<h2><span class="header-section-number">7.9</span> Refactoring</h2>
<div id="fix-ajoute-req" class="section level3" number="7.9.1">
<h3><span class="header-section-number">7.9.1</span> Fix : ajoute req</h3>
<p>Quand les données ne sont pas encore chargées, on peut avoir un rendu bizarre avec un message d’erreur.</p>
<p><img src="files/snapshots/error.png" /></p>
<p>Du coup, on introduit la fonction <code>req</code> (pour ‘requiert’) qui exécute la suite seulement si la condition est réalisée :</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="développement-dune-application-shiny.html#cb94-1" aria-hidden="true" tabindex="-1"></a>fComm <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb94-2"><a href="développement-dune-application-shiny.html#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(<span class="fu">codeInsee</span>()) <span class="do">## &lt; ici</span></span>
<span id="cb94-3"><a href="développement-dune-application-shiny.html#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="développement-dune-application-shiny.html#cb94-4" aria-hidden="true" tabindex="-1"></a>    fComm <span class="ot">&lt;-</span> flux <span class="sc">%&gt;%</span> <span class="fu">filter</span>(idcom <span class="sc">==</span> <span class="fu">codeInsee</span>())</span>
<span id="cb94-5"><a href="développement-dune-application-shiny.html#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fComm)</span>
<span id="cb94-6"><a href="développement-dune-application-shiny.html#cb94-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/115ac4ea9c236d74fcbfd1cb2d48d3ae6309b063">Voir cette version</a> (115ac4ea9c236d74fcbfd1cb2d48d3ae6309b063)</p>
</div>
</div>
<div id="carto-1" class="section level2" number="7.10">
<h2><span class="header-section-number">7.10</span> Carto</h2>
<div id="ajoute-un-marqueur" class="section level3" number="7.10.1">
<h3><span class="header-section-number">7.10.1</span> Ajoute un marqueur</h3>
<p><img src="files/snapshots/marqueur.png" /></p>
<p>On crée un proxy à la carte pour réaliser plus tard des actions sur celle-ci (zoomer, ajouter des éléments cartos) sans avoir à recalculer la carte (appelée mymap) à chaque fois :</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="développement-dune-application-shiny.html#cb95-1" aria-hidden="true" tabindex="-1"></a>proxy <span class="ot">&lt;-</span> <span class="fu">leafletProxy</span>(<span class="st">&quot;mymap&quot;</span>)</span></code></pre></div>
<p>On ajoute le centroïde de la commune cliquée :</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="développement-dune-application-shiny.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">observe</span>({</span>
<span id="cb96-2"><a href="développement-dune-application-shiny.html#cb96-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(<span class="fu">codeInsee</span>())</span>
<span id="cb96-3"><a href="développement-dune-application-shiny.html#cb96-3" aria-hidden="true" tabindex="-1"></a>    myComm <span class="ot">&lt;-</span> comms <span class="sc">%&gt;%</span> <span class="fu">filter</span>(INSEE_COM <span class="sc">==</span> <span class="fu">codeInsee</span>())</span>
<span id="cb96-4"><a href="développement-dune-application-shiny.html#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="développement-dune-application-shiny.html#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Ajout du marqueur</span></span>
<span id="cb96-6"><a href="développement-dune-application-shiny.html#cb96-6" aria-hidden="true" tabindex="-1"></a>    proxy <span class="sc">%&gt;%</span> </span>
<span id="cb96-7"><a href="développement-dune-application-shiny.html#cb96-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">clearMarkers</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb96-8"><a href="développement-dune-application-shiny.html#cb96-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addMarkers</span>(<span class="at">data =</span> myComm <span class="sc">%&gt;%</span> st_centroid)</span>
<span id="cb96-9"><a href="développement-dune-application-shiny.html#cb96-9" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/5821ff9c63199ec0bae647a5874f2080bb9d3d5a">Voir cette version</a> (5821ff9c63199ec0bae647a5874f2080bb9d3d5a)</p>
</div>
<div id="ajoute-le-contour-de-la-commune" class="section level3" number="7.10.2">
<h3><span class="header-section-number">7.10.2</span> Ajoute le contour de la commune</h3>
<p><img src="files/snapshots/contour.png" /></p>
<p>On ajoute le contour de la commune (c’est plus sympa) :</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="développement-dune-application-shiny.html#cb97-1" aria-hidden="true" tabindex="-1"></a>proxy <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="développement-dune-application-shiny.html#cb97-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clearShapes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="développement-dune-application-shiny.html#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addPolygons</span>(<span class="at">data =</span> myComm,</span>
<span id="cb97-4"><a href="développement-dune-application-shiny.html#cb97-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> paletteCerema<span class="sc">$</span>secondaire<span class="sc">$</span>orange, </span>
<span id="cb97-5"><a href="développement-dune-application-shiny.html#cb97-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">weight =</span> <span class="dv">1</span>, </span>
<span id="cb97-6"><a href="développement-dune-application-shiny.html#cb97-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">smoothFactor =</span> <span class="fl">0.5</span>,</span>
<span id="cb97-7"><a href="développement-dune-application-shiny.html#cb97-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">opacity =</span> <span class="dv">1</span>, </span>
<span id="cb97-8"><a href="développement-dune-application-shiny.html#cb97-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">fillOpacity =</span> <span class="fl">0.3</span>,</span>
<span id="cb97-9"><a href="développement-dune-application-shiny.html#cb97-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">fillColor =</span> paletteCerema<span class="sc">$</span>secondaire<span class="sc">$</span>orange,</span>
<span id="cb97-10"><a href="développement-dune-application-shiny.html#cb97-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(<span class="at">color =</span> paletteCerema<span class="sc">$</span>secondaire<span class="sc">$</span>orange, </span>
<span id="cb97-11"><a href="développement-dune-application-shiny.html#cb97-11" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb97-12"><a href="développement-dune-application-shiny.html#cb97-12" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">fillOpacity =</span> <span class="fl">0.1</span>,</span>
<span id="cb97-13"><a href="développement-dune-application-shiny.html#cb97-13" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">bringToFront =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/9b4455e5213c849edcdad0a9d2f905f377f2f84a">Voir cette version</a> (9b4455e5213c849edcdad0a9d2f905f377f2f84a)</p>
</div>
<div id="va-vers-la-commune" class="section level3" number="7.10.3">
<h3><span class="header-section-number">7.10.3</span> Va vers la commune</h3>
<p><img src="files/snapshots/goto.png" /></p>
<p>Le marqueur s’affiche, le contour aussi, mais parfois la commune semble loin, lo i n, l o i n</p>
<p>Du coup, petite astuce ergonomique : au clic, on va automatiquement vers la commune cliquée :</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="développement-dune-application-shiny.html#cb98-1" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(myComm)</span>
<span id="cb98-2"><a href="développement-dune-application-shiny.html#cb98-2" aria-hidden="true" tabindex="-1"></a>proxy <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="développement-dune-application-shiny.html#cb98-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">flyToBounds</span>(<span class="at">lng1 =</span> <span class="fu">as.numeric</span>(bb<span class="sc">$</span>xmin),</span>
<span id="cb98-4"><a href="développement-dune-application-shiny.html#cb98-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat1 =</span> <span class="fu">as.numeric</span>(bb<span class="sc">$</span>ymin),</span>
<span id="cb98-5"><a href="développement-dune-application-shiny.html#cb98-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">lng2 =</span> <span class="fu">as.numeric</span>(bb<span class="sc">$</span>xmax),</span>
<span id="cb98-6"><a href="développement-dune-application-shiny.html#cb98-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat2 =</span> <span class="fu">as.numeric</span>(bb<span class="sc">$</span>ymax))</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/404f64ab1fbd9fe00dd9da0634faf407007278b5">Voir cette version</a> (404f64ab1fbd9fe00dd9da0634faf407007278b5)</p>
</div>
<div id="la-liste-déroulante-permet-daller-vers-une-commune" class="section level3" number="7.10.4">
<h3><span class="header-section-number">7.10.4</span> La liste déroulante permet d’aller vers une commune</h3>
<p><img src="files/snapshots/liste-goto.png" /></p>
<p>On peut même changer le comportement de la liste déroulante utilisée au début pour afficher les stats (<a href="https://github.com/datagistips/shiny-artif-app/commit/64c7a25268157cf832c9b57dc71b7dfffd663d9e#diff-ee89f65a0b4e0dccabce1672d6d689b4e2b6ca51ea1e746bdda1eca94aaa6e0fR73">voir cette ligne</a>) pour aller automatiquement vers la commune cliquée :</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="développement-dune-application-shiny.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">observeEvent</span>(input<span class="sc">$</span>communes, {</span>
<span id="cb99-2"><a href="développement-dune-application-shiny.html#cb99-2" aria-hidden="true" tabindex="-1"></a>    codeInsee <span class="ot">&lt;-</span> input<span class="sc">$</span>communes</span>
<span id="cb99-3"><a href="développement-dune-application-shiny.html#cb99-3" aria-hidden="true" tabindex="-1"></a>    bb <span class="ot">&lt;-</span> comms <span class="sc">%&gt;%</span> <span class="fu">filter</span>(INSEE_COM <span class="sc">==</span> codeInsee) <span class="sc">%&gt;%</span> st_bbox <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb99-4"><a href="développement-dune-application-shiny.html#cb99-4" aria-hidden="true" tabindex="-1"></a>    proxy <span class="sc">%&gt;%</span> <span class="fu">flyToBounds</span>(<span class="at">lng1 =</span> bb[<span class="dv">1</span>], <span class="at">lat1 =</span> bb[<span class="dv">2</span>], <span class="at">lng2 =</span> bb[<span class="dv">3</span>], <span class="at">lat2 =</span> bb[<span class="dv">4</span>])</span>
<span id="cb99-5"><a href="développement-dune-application-shiny.html#cb99-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>C’est aussi l’occasion d’introduire <code>observeEvent</code> qui ‘écoute’ les évènements, et qui, ici déclenche une action lorsqu’on choisit un élément dans la liste des communes (<code>input$communes</code>)</p>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/d295c184cd8801dfdcc4befb414d98ea8c0d4ea9">Voir cette version</a> (d295c184cd8801dfdcc4befb414d98ea8c0d4ea9)</p>
</div>
<div id="ajoute-lélément-vide-à-la-liste-des-communes" class="section level3" number="7.10.5">
<h3><span class="header-section-number">7.10.5</span> Ajoute l’élément vide à la liste des communes</h3>
<p><img src="files/snapshots/empty-element.png" /></p>
<p>Généralement, le premier élément d’une liste est une instruction type ‘Veuillez choisir une commune’</p>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/4e5c6628148bb98841d8468d10dea8a69b2e5c6d">Voir cette version</a> (4e5c6628148bb98841d8468d10dea8a69b2e5c6d)</p>
</div>
</div>
<div id="refactoring-1" class="section level2" number="7.11">
<h2><span class="header-section-number">7.11</span> Refactoring</h2>
<div id="précise-quil-faut-cliquer-sur-la-carte-pour-afficher-les-stats" class="section level3" number="7.11.1">
<h3><span class="header-section-number">7.11.1</span> Précise qu’il faut cliquer sur la carte pour afficher les stats</h3>
<p><img src="files/snapshots/message.png" /></p>
<p>Au lieu d’utiliser <code>req</code> (<a href="https://github.com/datagistips/shiny-artif-app/commit/115ac4ea9c236d74fcbfd1cb2d48d3ae6309b063">voir ce commit</a>) qui conditionne l’affichage à la sélection d’une commune, nous pouvons générer un message pour préciser qu’il faut cliquer sur la carte lorsqu’aucune commune n’a été cliquée.</p>
<p>Si aucune commune n’est sélectionnée : valeur nulle, alors on affiche ce message (<a href="https://github.com/datagistips/shiny-artif-app/commit/56fd55bfa4cc066af658f7c779398c95c8276275?diff=split#diff-ee89f65a0b4e0dccabce1672d6d689b4e2b6ca51ea1e746bdda1eca94aaa6e0fR202-R203">Voir la ligne de code</a>)
:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="développement-dune-application-shiny.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(<span class="fu">codeInsee</span>())) <span class="fu">return</span>(<span class="fu">tagList</span>(<span class="fu">icon</span>(<span class="st">&quot;mouse-pointer&quot;</span>), <span class="st">&quot;Cliquez sur la carte pour afficher les statistiques&quot;</span>))</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/56fd55bfa4cc066af658f7c779398c95c8276275">Voir cette version</a> (56fd55bfa4cc066af658f7c779398c95c8276275)</p>
</div>
</div>
<div id="dataviz-1" class="section level2" number="7.12">
<h2><span class="header-section-number">7.12</span> Dataviz</h2>
<div id="ajoute-la-treemap-et-supprime-la-légende" class="section level3" number="7.12.1">
<h3><span class="header-section-number">7.12.1</span> Ajoute la treemap et supprime la légende</h3>
<p><img src="files/snapshots/treemap.png" /></p>
<p>Tiens, comme on y est, pourquoi pas ajouter une treemap.</p>
<p><code>ui.R</code></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="développement-dune-application-shiny.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotlyOutput</span>(<span class="st">&quot;treemap&quot;</span>)</span></code></pre></div>
<p><code>server.R</code></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="développement-dune-application-shiny.html#cb102-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>treemap <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb102-2"><a href="développement-dune-application-shiny.html#cb102-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(<span class="fu">codeInsee</span>())</span>
<span id="cb102-3"><a href="développement-dune-application-shiny.html#cb102-3" aria-hidden="true" tabindex="-1"></a>    flux <span class="sc">%&gt;%</span> <span class="fu">makeTreemap</span>(<span class="fu">codeInsee</span>())  </span>
<span id="cb102-4"><a href="développement-dune-application-shiny.html#cb102-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/1edc95aebfe35df74ca77370b78dc1d0402157a6">Voir cette version</a> (1edc95aebfe35df74ca77370b78dc1d0402157a6)</p>
</div>
</div>
<div id="refactoring-2" class="section level2" number="7.13">
<h2><span class="header-section-number">7.13</span> Refactoring</h2>
<div id="sépare-en-ui.r-server.r-et-global.r" class="section level3" number="7.13.1">
<h3><span class="header-section-number">7.13.1</span> Sépare en <code>ui.R</code>, <code>server.R</code> et <code>global.R</code></h3>
<p>Lorsque le code d’une application devient conséquent, cela peut être utile, plutôt que d’utiliser un unique fichier <code>app.R</code>, de séparer le contenu dans trois fichiers : <code>ui.R</code>, <code>server.R</code> et <code>global.R</code></p>
<ul>
<li><code>ui.R</code> comprend les éléments d’interface auparavant contenus dans <code>ui &lt;- fluidPage({...})</code></li>
<li><code>server.R</code> comprend la logique applicative et fonctionnelle de l’application : mécanismes d’interrogation et de représentation des données, auparavant contenue dans <code>server &lt;- function(input, output) {...}</code></li>
<li><code>global.R</code> comprend les variables utilisées dans l’application.</li>
</ul>
</div>
<div id="au-sujet-de-global.r" class="section level3" number="7.13.2">
<h3><span class="header-section-number">7.13.2</span> Au sujet de <code>global.R</code></h3>
<p>Les variables contenues dans <code>global.R</code> deviennent automatiquement globales.</p>
<p>Il n’y a alors plus besoin d’utiliser la double flèche d’assignation des variables globales dans <code>global.R</code></p>
<p><code>server.R</code>
Précédemment, on avait ceci dans <code>server.R</code> :</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="développement-dune-application-shiny.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">monNom &lt;&lt;- &quot;Mathieu&quot;</span></span></code></pre></div>
</div>
<div id="global.r" class="section level3" number="7.13.3">
<h3><span class="header-section-number">7.13.3</span> <code>global.R</code></h3>
<p>Dans <code>global.R</code>, la variable devient automatiquement globale même avec une assignation simple :</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="développement-dune-application-shiny.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">monNom &lt;- &quot;Mathieu&quot;</span><span class="st">`</span></span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/81991cf6ba1a4abef9df951bcdcc1858d97b6815">Voir cette version</a> (81991cf6ba1a4abef9df951bcdcc1858d97b6815)</p>
</div>
<div id="ajoute-un-fichier-helpers.r" class="section level3" number="7.13.4">
<h3><span class="header-section-number">7.13.4</span> Ajoute un fichier <code>helpers.R</code></h3>
<p>On peut créer un fichier annexe appelé <code>helpers.R</code> (nous aurions également pu l’appeler functions.R) dans lequel stocker les différentes stockées utilisées auparavant dans <code>server.R</code></p>
<p>Cela a le mérite de rendre le code du fichier <code>server.R</code> plus <em>léger</em>, plus <em>lisible</em> car mettant en évidence les mécanismes de façon macro plutôt que micro avec le détail de leur fonctionnement interne.</p>
<p>Nous faisons appel au fichier <code>helpers.R</code> au sein de <code>global.R</code></p>
</div>
<div id="global.r-1" class="section level3" number="7.13.5">
<h3><span class="header-section-number">7.13.5</span> <code>global.R</code></h3>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="développement-dune-application-shiny.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;helpers.R&quot;</span>, <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif-app/commit/b6a508c9db407cdc98969b50b80867554978796c">Voir cette version</a> (b6a508c9db407cdc98969b50b80867554978796c)</p>
</div>
</div>
<div id="contexte-2" class="section level2" number="7.14">
<h2><span class="header-section-number">7.14</span> Contexte</h2>
<p>On ajoute un fichier <a href="https://github.com/datagistips/shiny-artif0920-app/blob/master/footer.md"><code>footer.md</code></a> qui explique d’où vient l’application, donne les sources.</p>
<p>On l’intègre avec la fonction <code>includeMarkdown</code></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="développement-dune-application-shiny.html#cb106-1" aria-hidden="true" tabindex="-1"></a>tags<span class="sc">$</span><span class="fu">div</span>(</span>
<span id="cb106-2"><a href="développement-dune-application-shiny.html#cb106-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">includeMarkdown</span>(<span class="st">&quot;footer.md&quot;</span>), </span>
<span id="cb106-3"><a href="développement-dune-application-shiny.html#cb106-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">style=</span><span class="st">&quot;font-size:0.8em&quot;</span>)</span></code></pre></div>
<p>► <a href="https://github.com/datagistips/shiny-artif0920-app/commit/d52adde3e3c68bd6e647443e5190630f75f5f9c9#diff-65704ad9823485af15425c156225c6a1aa8551dfcbb918cbb3781a4372684d62">Voir cette version</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spatial.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="réflexions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["support.pdf", "support.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
